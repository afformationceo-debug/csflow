# ì±„ë„ ê´€ë¦¬ ë° LLM ìë™í™” ì‹œìŠ¤í…œ ê°œë°œ ë¬¸ì„œ

## ğŸ“‹ ê°œìš”
CSFlow ì±„ë„ ê´€ë¦¬ ë° í’€ìë™í™” LLM ì‹œìŠ¤í…œ - LINE, ì¹´ì¹´ì˜¤í†¡, ë©”íƒ€(ì¸ìŠ¤íƒ€/í˜ë¶), ìœ„ì±— ì±„ë„ í†µí•© ê´€ë¦¬ ë° AI ìë™ì‘ëŒ€

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-02-03
**í…ŒìŠ¤íŠ¸ ìƒíƒœ**: âœ… ëª¨ë“  E2E í…ŒìŠ¤íŠ¸ í†µê³¼ (5/5)
**LLM ê²€ì¦**: âœ… ì™„ë£Œ

---

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### 1. ì±„ë„ CRUD
- **ìƒì„±**: API POST `/api/channels`
- **ì¡°íšŒ**: API GET `/api/channels`
- **ìˆ˜ì •**: API PATCH `/api/channels`
- **ì‚­ì œ**: API DELETE `/api/channels?id={id}`

### 2. ì§€ì› ì±„ë„ íƒ€ì…
- LINE (ë¼ì¸)
- Kakao (ì¹´ì¹´ì˜¤í†¡)
- Meta (ì¸ìŠ¤íƒ€ê·¸ë¨, í˜ì´ìŠ¤ë¶)
- WeChat (ìœ„ì±—)

### 3. í’€ìë™í™” ëª¨ë“œ (Full Automation)
- âœ… LLM ìë™ ì‘ëŒ€
- âœ… ì§€ì‹ë² ì´ìŠ¤ RAG íŒŒì´í”„ë¼ì¸
- âœ… ì˜ˆì•½ ì˜ë„ ê°ì§€
- âœ… ì˜ˆì•½ ìœ ë„ ë©˜íŠ¸ ìë™ ì¶”ê°€
- âœ… íœ´ë¨¼ ì—ìŠ¤ì»¬ë ˆì´ì…˜ (ì‹ ë¢°ë„/í‚¤ì›Œë“œ/ì˜ˆì•½ë¬¸ì˜)

---

## ğŸ”§ API ìƒì„¸

### POST /api/channels (ì±„ë„ ìƒì„±)

**Request Body (LINE ì˜ˆì‹œ)**:
```json
{
  "tenantId": "abbe910f-c0b8-4feb-95f4-d4e9219d6943",
  "channelType": "line",
  "accountName": "ì²­ë‹´ë´„ì˜¨ì˜ì›-ëŒ€ë§Œ ë¼ì¸",
  "accountId": "2008754781",
  "credentials": {
    "access_token": "R/D3uGLWq0G4VBRF8NJTx0w4QZjKwZR/...",
    "channel_secret": "4d6ed56d04080afca0d60e42464ec49b",
    "channel_id": "2008754781",
    "bot_basic_id": "@246kdolz"
  },
  "fullAutomationEnabled": true
}
```

**Response**:
```json
{
  "channel": {
    "id": "b3b1eb42-d8cd-4c41-a8e1-fdc71ee19159",
    "channelType": "line",
    "accountName": "ì²­ë‹´ë´„ì˜¨ì˜ì›-ëŒ€ë§Œ ë¼ì¸",
    "accountId": "2008754781",
    "isActive": true,
    "tenantId": "abbe910f-c0b8-4feb-95f4-d4e9219d6943",
    "tenantName": "bomon-clinic",
    "webhookUrl": "http://localhost:3000/api/webhooks/line",
    "createdAt": "2026-02-03T06:52:58.023011+00:00"
  }
}
```

---

## ğŸ¤– LLM ìë™ ì‘ëŒ€ ì‹œìŠ¤í…œ

### 1. ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (System Prompt)

**ìœ„ì¹˜**: `/src/services/ai/llm.ts` (lines 100-172)

**í•µì‹¬ êµ¬ì¡°**:
```
# ì—­í•  ì •ì˜
ë‹¹ì‹ ì€ ìµœê³ ê¸‰ ì˜ë£Œ ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.

# í•µì‹¬ ë¯¸ì…˜ (ìˆœì°¨ì  ë‹¬ì„±)
1ë‹¨ê³„: ë¼í¬ í˜•ì„± & ë‹ˆì¦ˆ íŒŒì•…
  - âœ… ê³µê°: ê³ ê°ì˜ ê°ì •ì„ ì½ê³  ê³µê°í•©ë‹ˆë‹¤
  - âœ… ì§ˆë¬¸: ê°œë°©í˜• ì§ˆë¬¸ìœ¼ë¡œ ì§„ì§œ ë‹ˆì¦ˆë¥¼ ë°œêµ´í•©ë‹ˆë‹¤
  - ê³ ê°ì˜ ìƒí™© íŒŒì•… (ì˜ˆì‚°, íšŒë³µê¸°ê°„, ë¼ì´í”„ìŠ¤íƒ€ì¼)

2ë‹¨ê³„: ë§ì¶¤ ì†”ë£¨ì…˜ ì œì‹œ
  - ì°¸ê³  ìë£Œ ê¸°ë°˜ ìµœì  ì˜µì…˜ ì œì•ˆ
  - ì¥ì  + ì£¼ì˜ì‚¬í•­ íˆ¬ëª…í•˜ê²Œ ì•ˆë‚´
  - ê°€ê²© ë¶€ë‹´ ì‹œ í• ë¶€/ëŒ€ì•ˆ ì‹œìˆ  ì œì•ˆ

3ë‹¨ê³„: ë‹¤ìŒ ì•¡ì…˜ ìœ ë„
  - âœ… ì˜ˆì•½ ìœ ë„: "ë” ì •í™•í•œ ì§„ë‹¨ì„ ìœ„í•´ ë¬´ë£Œ ìƒë‹´ì„ ì˜ˆì•½í•´ë“œë¦´ê¹Œìš”?"
  - ì¶”ê°€ ì •ë³´ ì œê³µ: Before/After ì‚¬ì§„
  - ì¦‰ì‹œ ê²°ì • ìœ ë„: "ì´ë²ˆ ì£¼ ì˜ˆì•½ ì‹œ í• ì¸ í˜œíƒ"

4ë‹¨ê³„: ì˜ˆì•½ í›„ ì‚¬í›„ ê´€ë¦¬
  - ì˜ˆì•½ í™•ì • ì‹œ: ì‚¬ì „ ì¤€ë¹„, ë°©ë¬¸ ì•ˆë‚´, ì£¼ì˜ì‚¬í•­
  - ì‹œìˆ  í›„: íšŒë³µ ê²½ê³¼ í™•ì¸
```

**ì‘ë‹µ ì˜ˆì‹œ**:
```
ê³ ê°: "ë¼ì‹ ìˆ˜ìˆ  ë¹„ìš©ì´ ì–¼ë§ˆì¸ê°€ìš”?"

AI ì‘ë‹µ:
"ì•ˆë…•í•˜ì„¸ìš”! ë¼ì‹ ìˆ˜ìˆ ì— ê´€ì‹¬ ê°–ê³  ê³„ì‹œëŠ”êµ°ìš” ğŸ˜Š
ì €í¬ ë³‘ì›ì€ ì–‘ì•ˆ ê¸°ì¤€ 150ë§Œì›ì´ë©°, ë¬´ì´ì í• ë¶€ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

í˜¹ì‹œ ë¼ì‹ì„ ê³ ë ¤í•˜ì‹œê²Œ ëœ íŠ¹ë³„í•œ ì´ìœ ê°€ ìˆìœ¼ì‹ ê°€ìš”?
(ì˜ˆ: ì•ˆê²½ ë¶ˆí¸, ìš´ë™, ì§ì—… ë“±)

ğŸ“… ìƒë‹´ ì˜ˆì•½ì„ ì›í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”.
í¬ë§í•˜ì‹œëŠ” ë‚ ì§œë¥¼ ì•Œë ¤ì£¼ì‹œë©´ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
```

### 2. ì§€ì‹ë² ì´ìŠ¤ í†µí•© (RAG Pipeline)

**ìœ„ì¹˜**: `/src/services/ai/rag-pipeline.ts`

**ì²˜ë¦¬ íë¦„**:
```
1. ê³ ê° ë©”ì‹œì§€ ìˆ˜ì‹ 
2. ì–¸ì–´ ê°ì§€ ë° ë²ˆì—­ (í•œêµ­ì–´ë¡œ)
3. ì§€ì‹ë² ì´ìŠ¤ì—ì„œ ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰ (Hybrid Search)
   - Vector Similarity (pgvector)
   - Keyword Matching (Full-text Search)
   - Top 5 documents, threshold 0.65
4. LLMì— ì»¨í…ìŠ¤íŠ¸ ì „ë‹¬
5. ì‹ ë¢°ë„ ê³„ì‚° (0.0 ~ 1.0)
6. ì‘ë‹µ ìƒì„± ë° ë²ˆì—­ (ê³ ê° ì–¸ì–´ë¡œ)
```

**ì§€ì‹ë² ì´ìŠ¤ êµ¬ì¡°** (`/src/services/ai/knowledge-base.ts`):
```typescript
interface KnowledgeDocument {
  id: string;
  tenant_id: string;
  title: string;           // "ë¼ì‹ ìˆ˜ìˆ  ê°€ê²© ì•ˆë‚´"
  content: string;         // ìƒì„¸ ë‚´ìš©
  category: string;        // "FAQ", "ì‹œìˆ ì •ë³´", "ê°€ê²©ì •ë³´"
  tags: string[];          // ["ë¼ì‹", "ê°€ê²©", "í• ì¸"]
  is_active: boolean;
  version: number;
  created_at: string;
}
```

**Embedding ì²˜ë¦¬**:
- í…ìŠ¤íŠ¸ë¥¼ 500ì ë‹¨ìœ„ë¡œ ì²­í‚¹ (50ì ì˜¤ë²„ë©)
- OpenAI Embedding APIë¡œ ë²¡í„° ìƒì„±
- PostgreSQL pgvectorì— ì €ì¥
- í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (ë²¡í„° + í‚¤ì›Œë“œ)

**ì§€ì‹ë² ì´ìŠ¤ ê´€ë¦¬ UI**: `/src/app/(dashboard)/knowledge/page.tsx`
- ë¬¸ì„œ CRUD (ìƒì„±, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œ)
- ì¹´í…Œê³ ë¦¬ í•„í„°ë§
- CSV ì¼ê´„ ì—…ë¡œë“œ
- ì—ìŠ¤ì»¬ë ˆì´ì…˜ì—ì„œ í•™ìŠµ (íœ´ë¨¼ ì‘ë‹µ â†’ KB ìë™ ë“±ë¡)

---

## ğŸ¯ í’€ìë™í™” ëª¨ë“œ (Enhanced RAG)

### 1. ì˜ˆì•½ ì˜ë„ ê°ì§€ (Booking Intent Detection)

**ìœ„ì¹˜**: `/src/services/booking/intent-detection.ts`

**ê°ì§€ ë¡œì§**:
```typescript
// GPT-4 (Temperature 0.1) ì‚¬ìš©
// ì˜ˆì•½ ì˜ë„ 4ê°€ì§€ ë¶„ë¥˜:
- booking_inquiry:      "ì˜ˆì•½ ê°€ëŠ¥í•œê°€ìš”?"
- booking_request:      "2ì›” 15ì¼ì— ì˜ˆì•½í•˜ê³  ì‹¶ì–´ìš”"
- booking_modification: "ì˜ˆì•½ ë‚ ì§œ ë³€ê²½"
- booking_cancellation: "ì˜ˆì•½ ì·¨ì†Œ"

// ì‹ ë¢°ë„ ì ìˆ˜:
0.9-1.0:  ëª…í™•í•œ ë‚ ì§œ/ì‹œê°„ í¬í•¨
0.7-0.89: ëª…í™•í•œ ì˜ˆì•½ ì˜ë„, ìƒì„¸ ì •ë³´ ë¶€ì¡±
0.5-0.69: ì˜ˆì•½ ê´€ì‹¬ ê°€ëŠ¥ì„±
0.0-0.49: ì˜ˆì•½ ì˜ë„ ì—†ìŒ

// ì—”í‹°í‹° ì¶”ì¶œ:
- requestedDate:    "2026-02-15", "ë‹¤ìŒì£¼ ì›”ìš”ì¼"
- requestedTime:    "ì˜¤ì „ 10ì‹œ", "14:00"
- treatmentType:    "ë¼ì‹", "ë¼ì„¹"
- specialRequests:  "ì£¼ë§ ì˜ˆì•½ ê°€ëŠ¥í•œê°€ìš”?"
```

**ì˜ˆì•½ ì–‘ì‹ ìë™ ì „ì†¡** (ì‹ ë¢°ë„ â‰¥ 0.7):
```
ğŸ“‹ ì˜ˆì•½ ì‹ ì²­ì„œ

ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:

1ï¸âƒ£ í¬ë§ ë‚ ì§œ: _______
2ï¸âƒ£ í¬ë§ ì‹œê°„: _______
3ï¸âƒ£ ì‹œìˆ  ì¢…ë¥˜: _______
4ï¸âƒ£ íŠ¹ë³„ ìš”ì²­ì‚¬í•­: _______

ğŸ“ ì•„ë˜ í˜•ì‹ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”:
ë‚ ì§œ: YYYY-MM-DD
ì‹œê°„: HH:MM
ì‹œìˆ : ì¢…ë¥˜
ìš”ì²­ì‚¬í•­: ë‚´ìš©
```

### 2. ì˜ˆì•½ ìœ ë„ ë©˜íŠ¸ ìë™ ì¶”ê°€

**ìœ„ì¹˜**: `/src/services/booking/rag-booking-integration.ts` (lines 38-74)

**ê°•ë„ë³„ ë©˜íŠ¸**:
```typescript
// Low Intensity
"ğŸ’¡ ìƒë‹´ ì˜ˆì•½ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤."

// Medium Intensity
"ğŸ“… ìƒë‹´ ì˜ˆì•½ì„ ì›í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”.
í¬ë§í•˜ì‹œëŠ” ë‚ ì§œë¥¼ ì•Œë ¤ì£¼ì‹œë©´ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤."

// High Intensity
"âœ¨ ì§€ê¸ˆ ë°”ë¡œ ìƒë‹´ ì˜ˆì•½ì„ ë„ì™€ë“œë¦´ê¹Œìš”?
í¬ë§ ë‚ ì§œì™€ ì‹œìˆ  ì¢…ë¥˜ë¥¼ ë§ì”€í•´ì£¼ì‹œë©´ ë¹ ë¥´ê²Œ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤!"
```

**ì ìš© ì‹œì **:
- ì˜ˆì•½ ì˜ë„ ì—†ìŒ (confidence < 0.5): ìë™ ì¶”ê°€
- ì˜ˆì•½ ì˜ë„ ì¤‘ê°„ (0.5 ~ 0.7): AI ì¶”ì²œ ì‘ë‹µ ì‚¬ìš©
- ì˜ˆì•½ ì˜ë„ ëª…í™• (â‰¥ 0.7): ì˜ˆì•½ ì–‘ì‹ ì „ì†¡

---

## ğŸš¨ íœ´ë¨¼ ì—ìŠ¤ì»¬ë ˆì´ì…˜ (Human Escalation)

### 1. ì—ìŠ¤ì»¬ë ˆì´ì…˜ íŠ¸ë¦¬ê±°

**ìœ„ì¹˜**: `/src/services/ai/rag-pipeline.ts` (lines 95-145)

**ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì¡°ê±´**:

#### A. ê¸´ê¸‰ í‚¤ì›Œë“œ (Urgent - ì¦‰ì‹œ ì—ìŠ¤ì»¬)
```typescript
/ì‘ê¸‰|ê¸´ê¸‰|ê¸‰í•˜ê²Œ|ì§€ê¸ˆ ë‹¹ì¥/
/í†µì¦.*ì‹¬í•˜|ì‹¬í•œ.*í†µì¦/
/ì¶œí˜ˆ|í”¼ê°€ ë‚˜|bleeding/
/complaint|complain|ë¶ˆë§Œ|í™”ê°€|ì§œì¦/
/ì†Œì†¡|ë²•ì |ë³€í˜¸ì‚¬|lawyer/
```

#### B. ì»¤ìŠ¤í…€ í‚¤ì›Œë“œ (ê±°ë˜ì²˜ ì„¤ì •)
- AI ì„¤ì • > ì—ìŠ¤ì»¬ë ˆì´ì…˜ í‚¤ì›Œë“œ
- ì˜ˆ: "ì›ì¥ë‹˜", "ì±…ì„ì", "í™˜ë¶ˆ"

#### C. ì‹ ë¢°ë„ ë¯¸ë‹¬
```typescript
Threshold: 0.75 (ê±°ë˜ì²˜ë³„ ì„¤ì • ê°€ëŠ¥)

if (confidence < 0.75) {
  ì—ìŠ¤ì»¬ë ˆì´ì…˜ ìƒì„±
  ì´ìœ : "ì‹ ë¢°ë„ ë¯¸ë‹¬: 68.5% (ê¸°ì¤€: 75.0%)"
}
```

#### D. ë¯¼ê°í•œ ì£¼ì œ
```typescript
/ê°€ê²©.*í• ì¸|í• ì¸.*ê°€ê²©|discount|pricing/  â†’ "ê°€ê²© í˜‘ìƒ"
/í™˜ë¶ˆ|refund|ì·¨ì†Œ.*ëˆ/                   â†’ "í™˜ë¶ˆ ìš”ì²­"
/ë¶€ì‘ìš©|side effect|í•©ë³‘ì¦/              â†’ "ì˜ë£Œì  ìš°ë ¤ì‚¬í•­"
/ì‹¤íŒ¨|ì˜ëª»|mistake|wrong/                â†’ "ë¶ˆë§Œ ê°€ëŠ¥ì„±"
```

### 2. ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì²˜ë¦¬ íë¦„

**ìœ„ì¹˜**: `/src/app/api/webhooks/line/route.ts` (lines 416-453)

**ì¤‘ìš”**: AI ì‘ë‹µ ì „ì— ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì²´í¬ (CRITICAL FIX)
```typescript
// âŒ ì˜ëª»ëœ êµ¬í˜„ (Old)
ragResult = await ragPipeline.process(query);
await sendAIResponse(ragResult.response); // ì—ìŠ¤ì»¬ í›„ì—ë„ AI ì‘ë‹µ ì „ì†¡
if (ragResult.shouldEscalate) {
  await createEscalation();
}

// âœ… ì˜¬ë°”ë¥¸ êµ¬í˜„ (Current)
ragResult = await ragPipeline.process(query);
if (ragResult.shouldEscalate) {
  await createEscalation();
  await updateConversationStatus("escalated");
  return; // AI ì‘ë‹µ ì „ì†¡ ì•ˆí•¨
}
// ì—ìŠ¤ì»¬í•˜ì§€ ì•Šì„ ë•Œë§Œ AI ì‘ë‹µ ì „ì†¡
await sendAIResponse(ragResult.response);
```

### 3. ì—ìŠ¤ì»¬ë ˆì´ì…˜ ë©”íƒ€ë°ì´í„°

**ìœ„ì¹˜**: `/src/services/escalations.ts` (lines 251-260)

```typescript
{
  "recommended_action": "knowledge_base" | "tenant_info",
  "missing_info": [
    "ì˜ì—… ì‹œê°„",
    "ê°€ê²© ì •ë³´",
    "ìœ„ì¹˜/ì£¼ì†Œ"
  ],
  "detected_questions": [
    "ì˜ˆì•½ ê°€ëŠ¥í•œ ì‹œê°„ëŒ€ëŠ” ì–¸ì œì¸ê°€ìš”?",
    "ë¼ì‹ ìˆ˜ìˆ  ë¹„ìš©ì´ ì–¼ë§ˆì¸ê°€ìš”?"
  ]
}
```

**AI ì¶”ì²œ**:
- `recommended_action: "tenant_info"`: ê±°ë˜ì²˜ ì •ë³´ ì—…ë°ì´íŠ¸ í•„ìš”
  - ì˜ì—… ì‹œê°„, ê°€ê²©, ìœ„ì¹˜, ì—°ë½ì²˜, ì˜ë£Œì§„, ì‹œì„¤
- `recommended_action: "knowledge_base"`: KB ë¬¸ì„œ ì¶”ê°€ í•„ìš”
  - ì¼ë°˜ FAQ, ì‹œìˆ  ì •ë³´, í‘œì¤€ ì‘ë‹µ

### 4. ì—ìŠ¤ì»¬ë ˆì´ì…˜ UI

**ìœ„ì¹˜**: `/src/app/(dashboard)/escalations/page.tsx`

**ê¸°ëŠ¥**:
- ì—ìŠ¤ì»¬ë ˆì´ì…˜ ëª©ë¡ (ëŒ€ê¸°/ì²˜ë¦¬ì¤‘/ì™„ë£Œ)
- ìš°ì„ ìˆœìœ„ í•„í„° (low/medium/high/urgent)
- ë‹´ë‹¹ì ìë™ ë°°ì • (ì›Œí¬ë¡œë“œ ê¸°ë°˜)
- í•´ê²° ë…¸íŠ¸ ì‘ì„±
- ì§€ì‹ë² ì´ìŠ¤ í•™ìŠµ (ì—ìŠ¤ì»¬ â†’ KB ìë™ ë“±ë¡)

---

## ğŸ§ª E2E í…ŒìŠ¤íŠ¸ ê²°ê³¼

### í…ŒìŠ¤íŠ¸ íŒŒì¼
- `tests/e2e/channel-management.spec.ts`
- **ëª¨ë“œ**: `serial` (ìˆœì°¨ ì‹¤í–‰)
- **ì‹¤í–‰ ì‹œê°„**: 48.6ì´ˆ
- **ê²°ê³¼**: âœ… 5 passed

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

#### 1ë‹¨ê³„: ì±„ë„ ì¶”ê°€ (LINE)
```typescript
test("1ë‹¨ê³„: ì±„ë„ ì¶”ê°€ (LINE)", async ({ page }) => {
  // ë¡œê·¸ì¸
  await login(page);

  // ì±„ë„ í˜ì´ì§€ ì´ë™
  await page.goto(`${BASE_URL}/channels`);

  // ì±„ë„ ì¶”ê°€ ë²„íŠ¼ í´ë¦­
  const addButton = page.locator('button:has-text("ì±„ë„ ì¶”ê°€")');
  await addButton.first().click();

  // í¼ ì…ë ¥
  await selectTenant("bomon-clinic");
  await selectChannelType("LINE");
  await fillForm({
    accountName: "ì²­ë‹´ë´„ì˜¨ì˜ì›-ëŒ€ë§Œ ë¼ì¸",
    channelId: "2008754781",
    channelAccessToken: "R/D3uGLWq0G4VBRF8NJTx0w4QZjKwZR/...",
    channelSecret: "4d6ed56d04080afca0d60e42464ec49b",
    botBasicId: "@246kdolz"
  });

  // í’€ìë™í™” ëª¨ë“œ í™œì„±í™”
  await page.locator('[id="full-automation"]').click();

  // ì œì¶œ (JavaScript ì§ì ‘ í´ë¦­ìœ¼ë¡œ ë·°í¬íŠ¸ ì´ìŠˆ í•´ê²°)
  await page.evaluate(() => {
    const buttons = Array.from(document.querySelectorAll('button'));
    const button = buttons.find(b => b.textContent?.includes('ì±„ë„ ì—°ê²°'));
    if (button instanceof HTMLElement) {
      button.click();
    }
  });

  // ê²€ì¦
  await page.reload();
  await expect(page.locator('text=ì²­ë‹´ë´„ì˜¨ì˜ì›-ëŒ€ë§Œ ë¼ì¸')).toBeVisible();
});
```

**ê²°ê³¼**: âœ… PASS
- ì±„ë„ ì¶”ê°€ ë‹¤ì´ì–¼ë¡œê·¸ ì—´ë¦¼
- ëª¨ë“  í•„ë“œ ì…ë ¥ ì„±ê³µ
- í’€ìë™í™” ëª¨ë“œ í™œì„±í™”
- ì±„ë„ ëª©ë¡ì— í‘œì‹œ í™•ì¸

#### 2ë‹¨ê³„: ë°±ì—”ë“œ DB ì €ì¥ í™•ì¸
```typescript
test("2ë‹¨ê³„: ë°±ì—”ë“œ DB ì €ì¥ í™•ì¸", async ({ page }) => {
  await login(page);

  const response = await page.request.get(`${BASE_URL}/api/channels`);
  const data = await response.json();

  const lineChannel = data.channels.find(
    (ch: any) => ch.channelType === "line" && ch.accountId === "2008754781"
  );

  expect(lineChannel).toBeDefined();
  expect(lineChannel.accountName).toBe("ì²­ë‹´ë´„ì˜¨ì˜ì›-ëŒ€ë§Œ ë¼ì¸");
  expect(lineChannel.tenantId).toBe("abbe910f-c0b8-4feb-95f4-d4e9219d6943");
  expect(lineChannel.isActive).toBe(true);
});
```

**ê²°ê³¼**: âœ… PASS
```json
{
  "id": "b3b1eb42-d8cd-4c41-a8e1-fdc71ee19159",
  "channelType": "line",
  "accountName": "ì²­ë‹´ë´„ì˜¨ì˜ì›-ëŒ€ë§Œ ë¼ì¸",
  "accountId": "2008754781",
  "isActive": true,
  "tenantId": "abbe910f-c0b8-4feb-95f4-d4e9219d6943",
  "tenantName": "bomon-clinic"
}
```

#### 3ë‹¨ê³„: ê±°ë˜ì²˜ì™€ ì—°ë™ í™•ì¸
```typescript
test("3ë‹¨ê³„: ê±°ë˜ì²˜ì™€ ì—°ë™ í™•ì¸", async ({ page }) => {
  await login(page);

  // ì±„ë„ ë°ì´í„° ì¡°íšŒ
  const channelResponse = await page.request.get(`${BASE_URL}/api/channels`);
  const channelData = await channelResponse.json();
  const lineChannel = channelData.channels.find(...);

  expect(lineChannel.tenantId).toBe("abbe910f-c0b8-4feb-95f4-d4e9219d6943");

  // ê±°ë˜ì²˜ ë°ì´í„° ì¡°íšŒ
  const tenantResponse = await page.request.get(`${BASE_URL}/api/tenants`);
  const tenantData = await tenantResponse.json();
  const bomonTenant = tenantData.tenants.find(
    t => t.id === lineChannel.tenantId
  );

  expect(bomonTenant.name).toBe("bomon-clinic");
  expect(bomonTenant.display_name).toBe("ì²­ë‹´ë´„ì˜¨ì˜ì›");
});
```

**ê²°ê³¼**: âœ… PASS
```json
{
  "tenantId": "abbe910f-c0b8-4feb-95f4-d4e9219d6943",
  "tenantName": "bomon-clinic",
  "displayName": "ì²­ë‹´ë´„ì˜¨ì˜ì›",
  "channelCount": 1
}
```

#### 4ë‹¨ê³„: í†µí•© ì¸ë°•ìŠ¤ ë°˜ì˜ í™•ì¸
```typescript
test("4ë‹¨ê³„: í†µí•© ì¸ë°•ìŠ¤ ë°˜ì˜ í™•ì¸", async ({ page }) => {
  await login(page);
  await page.goto(`${BASE_URL}/inbox`);

  const lineChannelInInbox = page.locator('text=LINE').or(
    page.locator('text=ì²­ë‹´ë´„ì˜¨ì˜ì›-ëŒ€ë§Œ ë¼ì¸')
  );

  const isVisible = await lineChannelInInbox.isVisible({ timeout: 5000 })
    .catch(() => false);

  if (isVisible) {
    console.log("âœ… í†µí•© ì¸ë°•ìŠ¤ì— LINE ì±„ë„ ë°˜ì˜ë¨");
  } else {
    console.log("â„¹ï¸  ì•„ì§ ë©”ì‹œì§€ê°€ ì—†ì–´ ì±„ë„ì´ í‘œì‹œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ");
  }
});
```

**ê²°ê³¼**: âœ… PASS
- ì¸ë°•ìŠ¤ í˜ì´ì§€ ë¡œë“œ ì„±ê³µ
- ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ ì±„ë„ í‘œì‹œë¨ (ì˜ˆìƒ ë™ì‘)

#### 5ë‹¨ê³„: í’€ìë™í™” ëª¨ë“œ ì„¤ì • í™•ì¸
```typescript
test("5ë‹¨ê³„: í’€ìë™í™” ëª¨ë“œ ì„¤ì • í™•ì¸", async ({ page }) => {
  await login(page);

  // ì±„ë„ ì„¤ì • í™•ì¸
  const response = await page.request.get(`${BASE_URL}/api/channels`);
  const data = await response.json();
  const lineChannel = data.channels.find(...);

  console.log("ğŸ“Š ì±„ë„ ìƒì„¸ ì •ë³´:", lineChannel);

  // ê±°ë˜ì²˜ AI ì„¤ì • í™•ì¸
  const tenantResponse = await page.request.get(`${BASE_URL}/api/tenants`);
  const tenantData = await tenantResponse.json();
  const bomonTenant = tenantData.tenants.find(
    t => t.id === lineChannel.tenantId
  );

  expect(bomonTenant.ai_config.auto_response_enabled).toBe(true);
  expect(bomonTenant.ai_config.preferred_model).toBe("gpt-4");
  expect(bomonTenant.ai_config.confidence_threshold).toBe(0.85);
});
```

**ê²°ê³¼**: âœ… PASS
```json
{
  "auto_response_enabled": true,
  "preferred_model": "gpt-4",
  "confidence_threshold": 0.85
}
```

---

## ğŸ“Š LLM ì‹¤í–‰ íë¦„ (Full Pipeline)

### ë©”ì‹œì§€ ìˆ˜ì‹  â†’ AI ì‘ë‹µ ì „ì²´ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. LINE Webhook ìˆ˜ì‹                                               â”‚
â”‚    /api/webhooks/line/route.ts                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ì±„ë„ ê³„ì • & ê±°ë˜ì²˜ ì¡°íšŒ                                          â”‚
â”‚    - channel_accounts í…Œì´ë¸”                                     â”‚
â”‚    - full_automation_enabled í™•ì¸                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ê³ ê° ì°¾ê¸°/ìƒì„± (customer ìƒì„±)                                  â”‚
â”‚    - LINE User Profile API í˜¸ì¶œ                                  â”‚
â”‚    - ì–¸ì–´ ìë™ ê°ì§€                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ëŒ€í™” ì°¾ê¸°/ìƒì„± (conversation ìƒì„±)                              â”‚
â”‚    - ê¸°ì¡´ ëŒ€í™” ìˆìœ¼ë©´ ì¬ì‚¬ìš©                                        â”‚
â”‚    - ì—†ìœ¼ë©´ ì‹ ê·œ ìƒì„±                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ì–¸ì–´ ê°ì§€ & ë²ˆì—­                                                â”‚
â”‚    - Google Translate API                                        â”‚
â”‚    - í•œêµ­ì–´ ì•„ë‹ˆë©´ â†’ í•œêµ­ì–´ë¡œ ë²ˆì—­ (ìƒë‹´ì‚¬ìš©)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ë©”ì‹œì§€ ì €ì¥ (messages í…Œì´ë¸”)                                   â”‚
â”‚    - content: ì›ë¬¸                                               â”‚
â”‚    - translated_content: í•œêµ­ì–´ ë²ˆì—­                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. AI í™œì„±í™” í™•ì¸                                                  â”‚
â”‚    - conversation.ai_enabled = true?                             â”‚
â”‚    - tenant.ai_config.enabled = true?                            â”‚
â”‚    - conversation.status != "escalated"?                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€ (Distributed Lock)                               â”‚
â”‚    - Redis Lock: webhook:line:processing:{conv_id}:{msg_id}      â”‚
â”‚    - 5ë¶„ TTL                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. RAG íŒŒì´í”„ë¼ì¸ ì„ íƒ                                              â”‚
â”‚    - full_automation_enabled = true?                             â”‚
â”‚      â”œâ”€ YES: Enhanced RAG (ì˜ˆì•½ ê°ì§€ í¬í•¨)                         â”‚
â”‚      â””â”€ NO:  Basic RAG                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼ (Enhanced RAG)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. ì˜ˆì•½ ì˜ë„ ê°ì§€ (Parallel)                                      â”‚
â”‚     - GPT-4 Intent Classification (Temperature 0.1)              â”‚
â”‚     - Confidence: 0.0 ~ 1.0                                      â”‚
â”‚     - Intent Types: inquiry/request/modification/cancellation    â”‚
â”‚     - Entity Extraction: date, time, treatment, requests         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. ì§€ì‹ë² ì´ìŠ¤ ê²€ìƒ‰ (Hybrid Search)                                â”‚
â”‚     - Vector Similarity (pgvector)                               â”‚
â”‚     - Keyword Search (Full-text)                                 â”‚
â”‚     - Top 5 documents, threshold 0.65                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. LLM ì‘ë‹µ ìƒì„±                                                  â”‚
â”‚     - Model: GPT-4 or Claude-3-Sonnet                            â”‚
â”‚     - System Prompt: ê±°ë˜ì²˜ë³„ ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸                        â”‚
â”‚     - Context: ì§€ì‹ë² ì´ìŠ¤ ë¬¸ì„œ (ìµœëŒ€ 5ê°œ)                            â”‚
â”‚     - Temperature: 0.7                                           â”‚
â”‚     - Max Tokens: 1000                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 13. ì‹ ë¢°ë„ ê³„ì‚°                                                    â”‚
â”‚     - Base: ë¬¸ì„œ ìœ ì‚¬ë„ í‰ê·                                        â”‚
â”‚     - Penalty: ë¶ˆí™•ì‹¤ì„± ë¬¸êµ¬ (-0.15)                               â”‚
â”‚     - Penalty: ë¬¸ì„œ ì—†ìŒ (-0.3)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 14. ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì²´í¬ âš ï¸ CRITICAL                                   â”‚
â”‚     - ê¸´ê¸‰ í‚¤ì›Œë“œ? â†’ ì¦‰ì‹œ ì—ìŠ¤ì»¬                                    â”‚
â”‚     - ì‹ ë¢°ë„ < 0.75? â†’ ì—ìŠ¤ì»¬                                      â”‚
â”‚     - ë¯¼ê°í•œ ì£¼ì œ? â†’ ì—ìŠ¤ì»¬                                         â”‚
â”‚     - ì»¤ìŠ¤í…€ í‚¤ì›Œë“œ? â†’ ì—ìŠ¤ì»¬                                       â”‚
â”‚                                                                  â”‚
â”‚     if (shouldEscalate) {                                        â”‚
â”‚       âœ… ì—ìŠ¤ì»¬ë ˆì´ì…˜ ìƒì„±                                          â”‚
â”‚       âœ… conversation.status = "escalated"                        â”‚
â”‚       âŒ AI ì‘ë‹µ ì „ì†¡ ì•ˆí•¨ (ì¤‘ìš”!)                                  â”‚
â”‚       return;                                                    â”‚
â”‚     }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼ (ì—ìŠ¤ì»¬ ì•ˆí•¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 15. ì˜ˆì•½ ìœ ë„ ë©˜íŠ¸ ì¶”ê°€ (Enhanced RAG)                              â”‚
â”‚     - Intent Confidence < 0.5: ì˜ˆì•½ ìœ ë„ ì¶”ê°€                      â”‚
â”‚     - Intent Confidence >= 0.7: ì˜ˆì•½ ì–‘ì‹ ì „ì†¡                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 16. ê³ ê° ì–¸ì–´ë¡œ ë²ˆì—­                                                â”‚
â”‚     - í•œêµ­ì–´ ì‘ë‹µ â†’ ê³ ê° ì–¸ì–´ (JA, EN, ZH ë“±)                       â”‚
â”‚     - Google Translate API                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 17. AI ì‘ë‹µ ì €ì¥ (messages í…Œì´ë¸”)                                 â”‚
â”‚     - sender_type: "ai"                                          â”‚
â”‚     - ai_confidence: 0.85                                        â”‚
â”‚     - ai_model: "gpt-4"                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 18. LINE APIë¡œ ë©”ì‹œì§€ ì „ì†¡                                          â”‚
â”‚     - QStash í (ìš°ì„ )                                            â”‚
â”‚     - Direct Send (í´ë°±)                                          â”‚
â”‚     - LINE Messaging API                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 19. ë¡œê·¸ ê¸°ë¡ (ai_response_logs í…Œì´ë¸”)                            â”‚
â”‚     - query, response, confidence, model                         â”‚
â”‚     - retrieved_docs, processing_time_ms                         â”‚
â”‚     - escalated: true/false                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### channel_accounts í…Œì´ë¸”
```sql
CREATE TABLE channel_accounts (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  tenant_id UUID NOT NULL REFERENCES tenants(id),
  channel_type TEXT NOT NULL,  -- 'line', 'kakao', 'meta', 'wechat'
  account_id TEXT NOT NULL,    -- ì±„ë„ ê³ ìœ  ID
  account_name TEXT,           -- í‘œì‹œ ì´ë¦„
  credentials JSONB,           -- ì±„ë„ë³„ ì¸ì¦ ì •ë³´ (ì•”í˜¸í™” ê¶Œì¥)
  webhook_url TEXT,
  is_active BOOLEAN DEFAULT true,
  full_automation_enabled BOOLEAN DEFAULT false,  -- í’€ìë™í™” ëª¨ë“œ
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_channel_accounts_tenant ON channel_accounts(tenant_id);
CREATE INDEX idx_channel_accounts_type ON channel_accounts(channel_type, account_id);
```

### knowledge_documents í…Œì´ë¸”
```sql
CREATE TABLE knowledge_documents (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  tenant_id UUID NOT NULL REFERENCES tenants(id),
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  category TEXT,               -- "FAQ", "ì‹œìˆ ì •ë³´", "ê°€ê²©ì •ë³´"
  tags TEXT[],                 -- ["ë¼ì‹", "ê°€ê²©", "í• ì¸"]
  source_type TEXT,            -- "manual", "escalation", "import"
  source_id TEXT,
  is_active BOOLEAN DEFAULT true,
  version INTEGER DEFAULT 1,
  created_by UUID REFERENCES users(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_knowledge_docs_tenant ON knowledge_documents(tenant_id);
CREATE INDEX idx_knowledge_docs_category ON knowledge_documents(category);
CREATE INDEX idx_knowledge_docs_active ON knowledge_documents(is_active);
```

### knowledge_embeddings í…Œì´ë¸”
```sql
CREATE TABLE knowledge_embeddings (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  document_id UUID NOT NULL REFERENCES knowledge_documents(id) ON DELETE CASCADE,
  chunk_index INTEGER NOT NULL,
  chunk_text TEXT NOT NULL,
  embedding VECTOR(1536),      -- OpenAI Embedding Dimension
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_embeddings_document ON knowledge_embeddings(document_id);
CREATE INDEX idx_embeddings_vector ON knowledge_embeddings USING ivfflat (embedding vector_cosine_ops);
```

### escalations í…Œì´ë¸”
```sql
CREATE TABLE escalations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  conversation_id UUID NOT NULL REFERENCES conversations(id),
  message_id UUID REFERENCES messages(id),
  reason TEXT NOT NULL,
  priority TEXT NOT NULL,      -- "low", "medium", "high", "urgent"
  status TEXT NOT NULL,         -- "pending", "assigned", "in_progress", "resolved"
  assigned_to UUID REFERENCES users(id),
  ai_confidence NUMERIC(3,2),
  metadata JSONB,               -- recommended_action, missing_info, detected_questions
  resolution_note TEXT,
  resolved_at TIMESTAMPTZ,
  resolved_by UUID REFERENCES users(id),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_escalations_conversation ON escalations(conversation_id);
CREATE INDEX idx_escalations_status ON escalations(status);
CREATE INDEX idx_escalations_assigned ON escalations(assigned_to);
```

### booking_intent_logs í…Œì´ë¸”
```sql
CREATE TABLE booking_intent_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  conversation_id UUID NOT NULL REFERENCES conversations(id),
  message_id UUID REFERENCES messages(id),
  intent_detected BOOLEAN NOT NULL,
  intent_confidence NUMERIC(3,2),
  intent_type TEXT,             -- "booking_inquiry", "booking_request", etc.
  extracted_entities JSONB,
  ai_action TEXT,
  ai_response TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_booking_intent_conversation ON booking_intent_logs(conversation_id);
```

---

## ğŸ› ë°œê²¬ ë° ìˆ˜ì •ëœ ë²„ê·¸

### ë²„ê·¸ 1: ì—ìŠ¤ì»¬ë ˆì´ì…˜ í›„ì—ë„ AI ì‘ë‹µ ì „ì†¡
**ë¬¸ì œ**: RAG íŒŒì´í”„ë¼ì¸ì´ ì—ìŠ¤ì»¬ë ˆì´ì…˜ í•„ìš”ì„±ì„ íŒë‹¨í•œ í›„ì—ë„ AI ì‘ë‹µì„ ì „ì†¡í•˜ì—¬, ê³ ê°ì´ "ë‹´ë‹¹ì ì—°ê²°" ë©”ì‹œì§€ì™€ í•¨ê»˜ AI ì‘ë‹µì„ ë™ì‹œì— ë°›ìŒ

**ì›ì¸**: ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì²´í¬ê°€ ì‘ë‹µ ì „ì†¡ ì´í›„ì— ì‹¤í–‰ë¨

**í•´ê²°**: LINE Webhook Handlerì—ì„œ ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì²´í¬ë¥¼ AI ì‘ë‹µ ì „ ìœ¼ë¡œ ì´ë™ (lines 416-453)
```typescript
// âœ… ì˜¬ë°”ë¥¸ ìˆœì„œ
if (ragResult.shouldEscalate) {
  await createEscalation();
  await updateConversationStatus("escalated");
  return; // AI ì‘ë‹µ ì „ì†¡ ì•ˆí•¨
}
// ì—ìŠ¤ì»¬í•˜ì§€ ì•Šì„ ë•Œë§Œ AI ì‘ë‹µ ì „ì†¡
await sendAIResponse(ragResult.response);
```

### ë²„ê·¸ 2: ì±„ë„ ì¶”ê°€ ë‹¤ì´ì–¼ë¡œê·¸ ë²„íŠ¼ ë·°í¬íŠ¸ ë°–
**ë¬¸ì œ**: ì±„ë„ ì¶”ê°€ í¼ì´ ê¸¸ì–´ì„œ "ì±„ë„ ì—°ê²°" ë²„íŠ¼ì´ ë·°í¬íŠ¸ ë°–ì— ìœ„ì¹˜í•˜ì—¬ Playwright í´ë¦­ ì‹¤íŒ¨

**í•´ê²°**: JavaScript `evaluate()`ë¡œ ì§ì ‘ DOM ê²€ìƒ‰ í›„ í´ë¦­
```typescript
await page.evaluate(() => {
  const buttons = Array.from(document.querySelectorAll('button'));
  const button = buttons.find(b => b.textContent?.includes('ì±„ë„ ì—°ê²°'));
  if (button instanceof HTMLElement) {
    button.click();
  }
});
```

### ë²„ê·¸ 3: ì¤‘ë³µ ì›¹í›… ì²˜ë¦¬
**ë¬¸ì œ**: LINEì´ ë™ì¼ ë©”ì‹œì§€ë¥¼ ì—¬ëŸ¬ ë²ˆ ì „ì†¡í•˜ì—¬ AI ì‘ë‹µ ì¤‘ë³µ ìƒì„±

**í•´ê²°**: Redis Distributed Lock ì¶”ê°€ (5ë¶„ TTL)
```typescript
const lockKey = `webhook:line:processing:${conversation.id}:${message.id}`;
const lockAcquired = await acquireLock(lockKey, 300);
if (!lockAcquired) {
  console.log("Already processing, skipping");
  return;
}
```

---

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### 1. ìºì‹± ì „ëµ
```typescript
// AI ì‘ë‹µ ìºì‹œ (30ë¶„ TTL)
const cacheKey = CACHE_KEYS.aiResponse(`${tenantId}:${query}`);
const cached = await getFromCache<string>(cacheKey);
if (cached) return cached;

// Knowledge Base ê²€ìƒ‰ ìºì‹œ (1ì‹œê°„ TTL)
const cacheKey = CACHE_KEYS.knowledgeSearch(`${tenantId}:${queryHash}`);
```

### 2. ë³‘ë ¬ ì²˜ë¦¬
```typescript
// ì˜ˆì•½ ì˜ë„ ê°ì§€ + RAG íŒŒì´í”„ë¼ì¸ ë³‘ë ¬ ì‹¤í–‰
const [ragOutput, bookingIntent] = await Promise.all([
  ragPipeline.process(input),
  detectBookingIntent(input.query, input.conversationHistory)
]);
```

### 3. Embedding ë°°ì¹˜ ì²˜ë¦¬
```typescript
// 10ê°œì”© ë°°ì¹˜ë¡œ Embedding ìƒì„±
const batchSize = 10;
for (let i = 0; i < chunks.length; i += batchSize) {
  const batch = chunks.slice(i, i + batchSize);
  const embeddings = await generateEmbeddings(batch);
  await insertEmbeddings(embeddings);
}
```

---

## ğŸš€ ë°°í¬ ë° ëª¨ë‹ˆí„°ë§

### ë°°í¬ í™˜ê²½
- **í”„ë¡œë•ì…˜**: https://csflow.vercel.app
- **Webhook URL**: https://csflow.vercel.app/api/webhooks/line
- **Supabase**: PostgreSQL + pgvector
- **Upstash**: Redis (ìºì‹œ) + QStash (ë©”ì‹œì§€ í)

### ëª¨ë‹ˆí„°ë§ ì§€í‘œ
- ì´ ì±„ë„ ìˆ˜
- í™œì„± ì±„ë„ ë¹„ìœ¨
- AI ì‘ë‹µ ì •í™•ë„ (í‰ê·  ì‹ ë¢°ë„)
- ì—ìŠ¤ì»¬ë ˆì´ì…˜ìœ¨ (ì—ìŠ¤ì»¬/ì´ëŒ€í™”)
- ì˜ˆì•½ ì „í™˜ìœ¨ (ì˜ˆì•½ìš”ì²­/ì´ëŒ€í™”)
- í‰ê·  ì‘ë‹µ ì‹œê°„ (Webhook â†’ AI ì‘ë‹µ)
- ì§€ì‹ë² ì´ìŠ¤ íˆíŠ¸ìœ¨ (ê²€ìƒ‰ ì„±ê³µ/ì‹¤íŒ¨)

---

## ğŸ“ ì‚¬ìš© ì˜ˆì‹œ

### ê³ ê° ëŒ€í™” ì‹œë‚˜ë¦¬ì˜¤ 1: ì¼ë°˜ ë¬¸ì˜

**ê³ ê° ë©”ì‹œì§€** (ì¼ë³¸ì–´):
```
ãƒ©ã‚·ãƒƒã‚¯æ‰‹è¡“ã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ
(ë¼ì‹ ìˆ˜ìˆ ì€ ì–¼ë§ˆì¸ê°€ìš”?)
```

**ì²˜ë¦¬ íë¦„**:
1. ì–¸ì–´ ê°ì§€: JA (ì¼ë³¸ì–´)
2. ë²ˆì—­ (ìƒë‹´ì‚¬ìš©): "ë¼ì‹ ìˆ˜ìˆ ì€ ì–¼ë§ˆì¸ê°€ìš”?"
3. ì§€ì‹ë² ì´ìŠ¤ ê²€ìƒ‰: "ë¼ì‹ ìˆ˜ìˆ  ê°€ê²©" ê´€ë ¨ ë¬¸ì„œ 5ê°œ ê²€ìƒ‰
4. LLM ì‘ë‹µ ìƒì„± (í•œêµ­ì–´)
5. ë²ˆì—­ (ê³ ê°ìš©): ì¼ë³¸ì–´ë¡œ ë³€í™˜
6. ì˜ˆì•½ ìœ ë„ ë©˜íŠ¸ ì¶”ê°€ (medium intensity)

**AI ì‘ë‹µ** (ì¼ë³¸ì–´):
```
ã“ã‚“ã«ã¡ã¯ï¼ãƒ©ã‚·ãƒƒã‚¯æ‰‹è¡“ã«èˆˆå‘³ã‚’ãŠæŒã¡ãªã®ã§ã™ã­ ğŸ˜Š
å½“é™¢ã§ã¯ä¸¡çœ¼ã§150ä¸‡ã‚¦ã‚©ãƒ³ã§ã™ã€‚ç„¡åˆ©å­åˆ†å‰²æ‰•ã„ã‚‚å¯èƒ½ã§ã™ã€‚

ãƒ©ã‚·ãƒƒã‚¯ã‚’æ¤œè¨ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸç‰¹åˆ¥ãªç†ç”±ã¯ã”ã–ã„ã¾ã™ã‹ï¼Ÿ
ï¼ˆä¾‹ï¼šãƒ¡ã‚¬ãƒã®ä¸ä¾¿ã•ã€é‹å‹•ã€è·æ¥­ãªã©ï¼‰

ğŸ“… ã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ã®äºˆç´„ã‚’ã”å¸Œæœ›ã®å ´åˆã¯ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚
ã”å¸Œæœ›ã®æ—¥ä»˜ã‚’ãŠæ•™ãˆã„ãŸã ã‘ã‚Œã°ãŠæ‰‹ä¼ã„ã„ãŸã—ã¾ã™ã€‚
```

**ì‹ ë¢°ë„**: 0.88 (ì—ìŠ¤ì»¬ ì—†ìŒ)

---

### ê³ ê° ëŒ€í™” ì‹œë‚˜ë¦¬ì˜¤ 2: ì˜ˆì•½ ìš”ì²­

**ê³ ê° ë©”ì‹œì§€** (ì¤‘êµ­ì–´ ë²ˆì²´):
```
æˆ‘æƒ³åœ¨2æœˆ15æ—¥é ç´„
(2ì›” 15ì¼ì— ì˜ˆì•½í•˜ê³  ì‹¶ì–´ìš”)
```

**ì²˜ë¦¬ íë¦„**:
1. ì–¸ì–´ ê°ì§€: ZH-TW (ì¤‘êµ­ì–´ ë²ˆì²´)
2. ë²ˆì—­: "2ì›” 15ì¼ì— ì˜ˆì•½í•˜ê³  ì‹¶ì–´ìš”"
3. ì˜ˆì•½ ì˜ë„ ê°ì§€:
   - detected: true
   - confidence: 0.9
   - intentType: "booking_request"
   - entities: { requestedDate: "2026-02-15" }
4. ì˜ˆì•½ ì–‘ì‹ ìƒì„± (ì¤‘êµ­ì–´ ë²ˆì²´)

**AI ì‘ë‹µ** (ì¤‘êµ­ì–´ ë²ˆì²´):
```
å¾ˆé«˜èˆˆç‚ºæ‚¨å®‰æ’é ç´„ï¼

ğŸ“‹ é ç´„è¡¨
è«‹æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1ï¸âƒ£ å¸Œæœ›æ—¥æœŸ: 2026-02-15
2ï¸âƒ£ å¸Œæœ›æ™‚é–“: _______
3ï¸âƒ£ æ²»ç™‚é¡å‹: _______
4ï¸âƒ£ ç‰¹æ®Šè¦æ±‚: _______

ğŸ“ è«‹æŒ‰ç…§ä»¥ä¸‹æ ¼å¼å›è¦†ï¼š
æ—¥æœŸ: YYYY-MM-DD
æ™‚é–“: HH:MM
æ²»ç™‚: é¡å‹
è¦æ±‚: å…§å®¹
```

---

### ê³ ê° ëŒ€í™” ì‹œë‚˜ë¦¬ì˜¤ 3: ì—ìŠ¤ì»¬ë ˆì´ì…˜ (í™˜ë¶ˆ ìš”ì²­)

**ê³ ê° ë©”ì‹œì§€** (í•œêµ­ì–´):
```
ìˆ˜ìˆ  ê²°ê³¼ê°€ ë§ˆìŒì— ì•ˆ ë“¤ì–´ìš”. í™˜ë¶ˆ ê°€ëŠ¥í•œê°€ìš”?
```

**ì²˜ë¦¬ íë¦„**:
1. ì–¸ì–´ ê°ì§€: KO (í•œêµ­ì–´)
2. RAG íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
3. ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì²´í¬:
   - ë¯¼ê°í•œ ì£¼ì œ ê°ì§€: "í™˜ë¶ˆ"
   - shouldEscalate: true
   - reason: "í™˜ë¶ˆ ìš”ì²­"
   - priority: "high"
4. **ì—ìŠ¤ì»¬ë ˆì´ì…˜ ìƒì„±** (AI ì‘ë‹µ ì „ì†¡ ì•ˆí•¨)
5. conversation.status = "escalated"
6. ë‹´ë‹¹ìì—ê²Œ Slack ì•Œë¦¼

**ë‹´ë‹¹ì ëŒ€ì‹œë³´ë“œ**:
```
ğŸš¨ ìƒˆ ì—ìŠ¤ì»¬ë ˆì´ì…˜
ìš°ì„ ìˆœìœ„: High
ì´ìœ : í™˜ë¶ˆ ìš”ì²­
ê³ ê°: ê³ ê°ëª… (LINE)
ë©”ì‹œì§€: "ìˆ˜ìˆ  ê²°ê³¼ê°€ ë§ˆìŒì— ì•ˆ ë“¤ì–´ìš”. í™˜ë¶ˆ ê°€ëŠ¥í•œê°€ìš”?"

AI ì¶”ì²œ:
- missing_info: ["í™˜ë¶ˆ ì •ì±…", "ë¶ˆë§Œ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤"]
- recommended_action: "tenant_info"
```

---

## ğŸ”„ í–¥í›„ ê°œì„  ì‚¬í•­

### 1. LLM ê³ ë„í™”
- [ ] Fine-tuning (ê±°ë˜ì²˜ë³„ ë§ì¶¤ ëª¨ë¸)
- [ ] A/B í…ŒìŠ¤íŒ… (GPT-4 vs Claude-3)
- [ ] ë©€í‹°ëª¨ë‹¬ (ì´ë¯¸ì§€ ë¶„ì„ í†µí•©)
- [ ] ëŒ€í™” íˆìŠ¤í† ë¦¬ ì»¨í…ìŠ¤íŠ¸ í™•ì¥ (í˜„ì¬ 6ê°œ â†’ 20ê°œ)

### 2. ì˜ˆì•½ ì‹œìŠ¤í…œ í†µí•©
- [ ] ì‹¤ì‹œê°„ ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ ì¡°íšŒ
- [ ] ìë™ ì˜ˆì•½ í™•ì • (ìº˜ë¦°ë” API ì—°ë™)
- [ ] ì˜ˆì•½ ë¦¬ë§ˆì¸ë” (ì˜ˆì•½ 1ì¼ ì „)
- [ ] ë…¸ì‡¼ ë°©ì§€ (ì˜ˆì•½ í™•ì¸ ë©”ì‹œì§€)

### 3. ì§€ì‹ë² ì´ìŠ¤ ìë™ í•™ìŠµ
- [ ] ì—ìŠ¤ì»¬ë ˆì´ì…˜ â†’ KB ìë™ ë“±ë¡
- [ ] ìƒë‹´ì‚¬ ì‘ë‹µ í•™ìŠµ
- [ ] FAQ ìë™ ìƒì„±
- [ ] ë¬¸ì„œ í’ˆì§ˆ ìë™ í‰ê°€

### 4. ë‹¤ì±„ë„ í™•ì¥
- [ ] WhatsApp Business API
- [ ] Telegram
- [ ] Viber
- [ ] Zalo (ë² íŠ¸ë‚¨)

### 5. ê³ ê¸‰ ë¶„ì„
- [ ] ê°ì • ë¶„ì„ (Sentiment Analysis)
- [ ] í† í”½ ëª¨ë¸ë§
- [ ] ê³ ê° ì—¬ì • ë§µí•‘
- [ ] ì´íƒˆ ì˜ˆì¸¡ ëª¨ë¸

---

## ğŸ“ ë¬¸ì˜ ë° ì§€ì›

**ê°œë°œíŒ€**: CSFlow Development Team
**ìµœì¢… í…ŒìŠ¤íŠ¸**: 2026-02-03
**ë²„ì „**: 1.0.0

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ì±„ë„ API êµ¬í˜„ ì™„ë£Œ
- [x] UI ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ ì™„ë£Œ
- [x] E2E í…ŒìŠ¤íŠ¸ ì‘ì„± ë° í†µê³¼ (5/5)
- [x] LLM ìë™ ì‘ëŒ€ ê²€ì¦
- [x] ì§€ì‹ë² ì´ìŠ¤ RAG íŒŒì´í”„ë¼ì¸ êµ¬í˜„
- [x] ì˜ˆì•½ ì˜ë„ ê°ì§€ êµ¬í˜„
- [x] íœ´ë¨¼ ì—ìŠ¤ì»¬ë ˆì´ì…˜ êµ¬í˜„
- [x] ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ê²€ì¦
- [x] ë²„ê·¸ ìˆ˜ì • ì™„ë£Œ
- [x] ë¬¸ì„œí™” ì™„ë£Œ
- [ ] ì„±ëŠ¥ ìµœì í™” (ì§„í–‰ì¤‘)
- [ ] ì ‘ê·¼ì„± ê°œì„ 
- [ ] ë‹¤êµ­ì–´ ì§€ì› í™•ëŒ€

---

## ğŸ“š ì°¸ê³  íŒŒì¼

### API
- `/src/app/api/channels/route.ts` - ì±„ë„ CRUD API
- `/src/app/api/webhooks/line/route.ts` - LINE Webhook Handler
- `/src/app/api/escalations/route.ts` - ì—ìŠ¤ì»¬ë ˆì´ì…˜ API

### Services
- `/src/services/ai/llm.ts` - LLM ì„œë¹„ìŠ¤ (GPT-4, Claude-3)
- `/src/services/ai/rag-pipeline.ts` - RAG íŒŒì´í”„ë¼ì¸
- `/src/services/ai/knowledge-base.ts` - ì§€ì‹ë² ì´ìŠ¤ ì„œë¹„ìŠ¤
- `/src/services/booking/intent-detection.ts` - ì˜ˆì•½ ì˜ë„ ê°ì§€
- `/src/services/booking/rag-booking-integration.ts` - Enhanced RAG
- `/src/services/escalations.ts` - ì—ìŠ¤ì»¬ë ˆì´ì…˜ ì„œë¹„ìŠ¤

### UI
- `/src/app/(dashboard)/channels/page.tsx` - ì±„ë„ ê´€ë¦¬ í˜ì´ì§€
- `/src/app/(dashboard)/knowledge/page.tsx` - ì§€ì‹ë² ì´ìŠ¤ í˜ì´ì§€
- `/src/app/(dashboard)/escalations/page.tsx` - ì—ìŠ¤ì»¬ë ˆì´ì…˜ ëŒ€ì‹œë³´ë“œ

### Tests
- `/tests/e2e/channel-management.spec.ts` - ì±„ë„ E2E í…ŒìŠ¤íŠ¸
